<!doctype html>
<html lang="en">
<head>
  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <link href="https://unpkg.com/jquery-resizable-columns@0.2.3/dist/jquery.resizableColumns.css" rel="stylesheet">

  <link rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.18.0/dist/bootstrap-table.min.css">
  <link rel="stylesheet" href="utils.css">

  <script src="jquery-3.5.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
  <script src="https://unpkg.com/bootstrap-table@1.18.0/dist/bootstrap-table.min.js"></script>
  <script src="https://unpkg.com/bootstrap-table@1.18.0/dist/extensions/resizable/bootstrap-table-resizable.min.js"></script>
  <script src="Chart.min.js"></script>
  <script src="utils.js"></script>
  <style>
    canvas {
      -moz-user-select: none;
      -webkit-user-select: none;
      -ms-user-select: none;
  }
</style>

<title>Medical AI Evaluation Database</title>

<style type="text/css">
    html {
      font-size: 0.75rem;
  }

</style>
</head>
<body>

  <nav class="navbar navbar-expand-md navbar-light mb-0 sticky-top" style="background-color: #efefef;">
    <a class="navbar-brand" href="#">Medical AI Evaluation</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarCollapse">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item active">
          <a class="nav-link" href="#database">Database</a>
      </li>
      <li class="nav-item">
          <a class="nav-link" href="#viz">Visualizations</a>
      </li>
  </ul>

</div>
</nav>

<main>
    <div class="container-fluid bg-light mt-0" style="
    background-image: url('bg.jpg');
    background-size: cover;
    ">
    <div class="row py-lg-5">
      <div class="col-lg-6 col-md-8 mx-auto">
        <h1 class="fw-light">Medical AI Evaluation</h1>
        <p class="lead text-muted">We aggregate all 130 AI/ML FDA-approved medical devices and report information on risk and bias.</p>
        <p>
          <a href="https://github.com/ericwu09/medical-ai-evaluation" target="_blank" class="btn btn-primary my-2">View the Code</a>
          <a href="paper.pdf" target="_blank" class="btn btn-secondary my-2">Read the Paper</a>
      </p>
  </div>
</div>
</div>

<div id="database" class="container-fluid mx-lg-auto px-md-5 py-md-5 bg-light">

    <h2>Device Database</h2>
    <table id="table" border="1" class="dataframe table-bordered table-striped table-hover"
    data-toggle="table"
    data-url="table.json"
    data-height="600"
    data-pagination="true"
    data-page-size="50"
    data-search="true"
    data-search-highlight="true"
    data-show-columns="true"
    data-show-columns-toggle-all="true"
    data-show-columns-search="true"
    data-detail-view="true"
    data-detail-formatter="detailFormatter">

    <thead>
      <tr style="text-align: center;">
<th data-field='approval_number' data-sortable='true' data-visible='true' data-switchable='true'><div data-toggle='tooltip' data-placement='top' title='FDA-assigned approval number for the device'>approval_number</div></th>
<th data-field='device_name' data-sortable='true' data-visible='true' data-switchable='true'><div data-toggle='tooltip' data-placement='top' title='Name of FDA-approved device'>device_name</div></th>
<th data-field='classification_product_code' data-sortable='true' data-visible='false' data-switchable='true'><div data-toggle='tooltip' data-placement='top' title='Classification product code used to identify the generic category of a device for FDA'>classification_product_code</div></th>
<th data-field='date_received' data-sortable='true' data-visible='false' data-switchable='true'><div data-toggle='tooltip' data-placement='top' title='Date that the device submission was received by the FDA'>date_received</div></th>
<th data-field='decision_date' data-sortable='true' data-visible='true' data-switchable='true'><div data-toggle='tooltip' data-placement='top' title='Date of FDA approval for the device'>decision_date</div></th>
<th data-field='indications_for_use' data-sortable='true' data-visible='false' data-switchable='true'><div data-toggle='tooltip' data-placement='top' title='Indications for use for the device'>indications_for_use</div></th>
<th data-field='body_area' data-sortable='true' data-visible='true' data-switchable='true'><div data-toggle='tooltip' data-placement='top' title='Body area of the underlying condition or disease treated'>body_area</div></th>
<th data-field='modality' data-sortable='true' data-visible='true' data-switchable='true'><div data-toggle='tooltip' data-placement='top' title='Modality used to acquire the images or data, eg. PET, MRI, X-ray'>modality</div></th>
<th data-field='predicate_numbers' data-sortable='true' data-visible='false' data-switchable='true'><div data-toggle='tooltip' data-placement='top' title='For 510(k) devices, the predicate device(s) cited, along with other reference devices'>predicate_numbers</div></th>
<th data-field='sample_size' data-sortable='true' data-visible='true' data-switchable='true'><div data-toggle='tooltip' data-placement='top' title='Number of patients enrolled in the evaluation study, if available'>sample_size</div></th>
<th data-field='num_sites' data-sortable='true' data-visible='true' data-switchable='true'><div data-toggle='tooltip' data-placement='top' title='Number of distinct clinical sites that the test population is sourced from'>num_sites</div></th>
<th data-field='inc_exc_criteria' data-sortable='true' data-visible='true' data-switchable='true'><div data-toggle='tooltip' data-placement='top' title='Whether the study specified the inclusion and/or exclusion criteria for the evaluation study'>inc_exc_criteria</div></th>
<th data-field='has_demographics' data-sortable='true' data-visible='true' data-switchable='true'><div data-toggle='tooltip' data-placement='top' title='Whether the study explicitly mentions data that is sourced across demographic subgroups'>has_demographics</div></th>
<th data-field='is_prospective' data-sortable='true' data-visible='true' data-switchable='true'><div data-toggle='tooltip' data-placement='top' title='Whether the study was performed prospectively or retrospectively'>is_prospective</div></th>
<th data-field='subtype_analysis' data-sortable='true' data-visible='true' data-switchable='true'><div data-toggle='tooltip' data-placement='top' title='Whether the study stratified performance by disease subtypes'>subtype_analysis</div></th>
<th data-field='significance' data-sortable='true' data-visible='false' data-switchable='true'><div data-toggle='tooltip' data-placement='top' title='Significance of the information provided by the device to the healthcare decision'>significance</div></th>
<th data-field='severity' data-sortable='true' data-visible='false' data-switchable='true'><div data-toggle='tooltip' data-placement='top' title='State of healthcare situation or condition that the device treats'>severity</div></th>
<th data-field='risk_level' data-sortable='true' data-visible='true' data-switchable='true'><div data-toggle='tooltip' data-placement='top' title='Overall risk level of the device'>risk_level</div></th>
<th data-field='keywords' data-sortable='true' data-visible='true' data-switchable='true'><div data-toggle='tooltip' data-placement='top' title='AI/ML keywords that appeared in the summary document'>keywords</div></th>
<th data-field='summary_link' data-sortable='true' data-visible='false' data-switchable='true'><div data-toggle='tooltip' data-placement='top' title='URL of the summary document PDF'>summary_link</div></th>
    </tr>
</thead>

</table>

</div>

<hr class="featurette-divider">
<div id="viz" class="container-fluid mx-lg-auto px-md-5">

  <h2>Visualizations</h2>


  <div class="container-fluid col-md-8 px-md-5 my-5">
    <div class="row justify-content-center">
        <h3>Device Summaries</h3>
    </div>
    <div class="row">
        <div class="my-5" style="width: 430px;">
          <button id="multisite" class="btn btn-outline-primary" data-toggle="button" aria-pressed="false">Show Multisite</button>
          <button id="prospective" class="btn btn-outline-primary" data-toggle="button" aria-pressed="false">Show Prospective</button>
          <button id="highrisk" class="btn btn-outline-primary" data-toggle="button" aria-pressed="false">Show High Risk</button>
          <div id="figure" class="my-5">

            <script>
                var devices = {}
                var head = [], heart = [], breast = [], chest = [], other = []

                $.getJSON( "table.json", function( data ) {
                  $.each( data, function( key, val ) {
                    devices[val['device_name']] = val
                    var classes = 'hovicon mini effect-9 sub-a'
                    if (val['risk_level'] == '1' || val['risk_level'] == '2') {
                      classes += ' highrisk'
                  }
                  if (val['num_sites'] == 'NA' || val['num_sites'] == '1') {
                      classes += ' multisite'
                  }
                  if (val['is_prospective'] != '1') {
                      classes += ' prospective'
                  }
                  var body_area = val['body_area'].toLowerCase()
                  classes += ' ' + body_area
                  if (body_area == 'chest') {
                    chest.push([val['device_name'], classes])
                } else if (body_area == 'head') {
                    head.push([val['device_name'], classes])
                } else if (body_area == 'breast') {
                    breast.push([val['device_name'], classes])
                } else if (body_area == 'heart') {
                    heart.push([val['device_name'], classes])
                } else {
                    other.push([val['device_name'], classes])
                }


            });

                  [chest, head, breast, heart, other].forEach(function (item, index) {
                      item.forEach(function (x, idx) {
                        var html = '<i id="'+x[0]+'" class="'+x[1]+'" data-toggle="tooltip" data-placement="top" title="'+x[0]+'"></i>'
                        $( "#figure" ).append(html)
                    });
                  });

              });



                $( "#multisite" ).click(function() {
                    $('.multisite').toggleClass('multisite-hover')
        //$('#multisite').toggleClass('active')
    });

                $( "#prospective" ).click(function() {
                    $('.prospective').toggleClass('prospective-hover')
        //$('#prospective').toggleClass('active')

    });

                $( "#highrisk" ).click(function() {
                    $('.highrisk').toggleClass('highrisk-hover')
        //$('#highrisk').toggleClass('active')

    });

</script>

</div>
</div>
<div class="col desc">
    <b>Device Name: </b><span id="desc_device_name"></span><br />
    <b>Approval Number: </b><span id="desc_approval_number"></span><br />
    <b>Decision Date: </b><span id="desc_decision_date"></span><br />
    <b>Indications for Use: </b><span id="desc_indications_for_use"></span><br />
    <b>Body Area: </b><span id="desc_body_area"></span><br />
    <b>Modality: </b><span id="desc_modality"></span><br />
    <b>Sample Size: </b><span id="desc_sample_size"></span><br />
    <b>Number of Sites: </b><span id="desc_num_sites"></span><br />
    <b>Risk Level: </b><span id="desc_risk_level"></span><br />
    <b>Has Inclusion/Exclusion Criteria?: </b><span id="desc_inc_exc_criteria"></span><br />
    <b>Has Demographic Data?: </b><span id="desc_has_demographics"></span><br />
    <b>Has a Prospective Study?: </b><span id="desc_is_prospective"></span><br />
    <b>Has Subtype Analysis?: </b><span id="desc_subtype_analysis"></span><br />
</div>
</div>

</div>

  <div id="container" class="col-lg-6 col-md-8 mx-auto my-5", style="width: 75%;" >
    <canvas id="bar"></canvas>
</div>

<div id="container" class="col-lg-6 col-md-8 mx-auto my-5", style="width: 75%;" >
    <canvas id="pie"></canvas>
</div>


</div>

</div>

<script>
  var color = Chart.helpers.color;

  var pieChartData = {
    type: 'doughnut',
    data: {
      datasets: [{
        data: [
        13, 15, 17, 25, 60
        ],
        backgroundColor: [
        window.chartColors.red,
        window.chartColors.orange,
        window.chartColors.yellow,
        window.chartColors.green,
        window.chartColors.blue,

        ],
        label: 'Body Area'
    }],
    labels: [
    'Chest',
    'Breast',
    'Heart',
    'Head',
    'Multiple/Other'
    ]
},
options: {
  responsive: true,
  legend: {
    position: 'right',
    labels: {
    fontSize: 16
    }
},
title: {
    display: true,
    text: 'Body Area Treated by Devices'
},
animation: {
    animateScale: true,
    animateRotate: true
}
}
};


var barChartData = {
    labels: ['2017', '2018', '2019', '2020'],
    datasets: [

    {
      label: 'AI Devices reporting multisite evaluation',
      yAxisID: 'A',
      stack: 'main',
      backgroundColor: color(window.chartColors.blue).alpha(0.5).rgbString(),
      borderColor: window.chartColors.blue,
      borderWidth: 1,
      data: [
      1, 8, 8, 20
      ]
  },
  {
      label: 'AI Devices approved',
      yAxisID: 'A',
      stack: 'main',
      backgroundColor: color(window.chartColors.blue).alpha(0.1).rgbString(),
      borderColor: window.chartColors.blue,
      borderWidth: 1,
      data: [
      6, 24, 3, 66
      ]
  },
  {
      label: 'Median study sample size',
      yAxisID: 'B',
      backgroundColor: color(window.chartColors.green).alpha(0.5).rgbString(),
      borderColor: window.chartColors.green,
      borderWidth: 2,
      type: 'line',
      cubicInterpolationMode: "monotonic",
      fill: false,
      data: [
      111, 300, 383, 261
      ]
  }]
};

window.onload = function() {

    var ctx1 = document.getElementById('pie').getContext('2d');
    window.myDoughnut = new Chart(ctx1, pieChartData);

    var ctx2 = document.getElementById('bar').getContext('2d');
    window.myBar = new Chart(ctx2, {
      type: 'bar',
      data: barChartData,
      options: {
        responsive: true,
        legend: {
          position: 'top',
          labels: {
    fontSize: 16
    }
      },
      title: {
          display: true,
          text: 'AI device approvals have increased in recent years, but multisite reporting and sample size has stagnated'
      },
      scales: {
         yAxes: [{
          stacked: true,
          id: 'A',
          display: true,
          position: 'left',
          ticks: {
           beginAtZero: true
       }
   }, {
    id: 'B',
    display: true,
    position: 'right',
    ticks: {
     fontColor: color(window.chartColors.green).rgbString(),
     beginAtZero: true,
     max: 700,
     min: 0,
     stepSize: 100
 }
}]
}
}
});

};

</script>

</div>

</main>



<script>

  $( "#figure" ).on("mouseover", "i", function() {
    $('[data-toggle="tooltip"]').tooltip()
})

  $( "#database" ).on("mouseover", "div", function() {
    $('[data-toggle="tooltip"]').tooltip()
})

  $( "#figure" ).on("click", "i", function() {
    $("#figure i").removeClass('hover')
    $(this).addClass('hover')
    var device_name = $(this).attr('id')
    var vals = devices[device_name]
    for (var key in vals) {
        $('#desc_'+key).html(vals[key])
    }
});
  

  $(function() {
    $('#table').bootstrapTable();
      //$('#table').bootstrapTable('hideColumn', 'query_id');
  })
  function datesSorter(a, b) {
    if (new Date(a) < new Date(b)) return 1;
    if (new Date(a) > new Date(b)) return -1;
    return 0;
}
function numSorter(a, b) {
    a = a.replace(">", "")
    b = b.replace(">", "")
    if (a == 'NA') return 1;
    if (b == 'NA') return -1;
    return Number(b) - Number(a)
}
function detailFormatter(index, row) {
    var html = ""
    $.each(row, function (key, value) {
      if (key == 'indications_for_use') {
        html = "<b>Indications for Use:</b> " + value
    }
})
    return html
}
</script>
</body>
</html>
